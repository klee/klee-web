---
version: 2.1

orbs: 
  ansible-playbook: orbss/ansible-playbook@0.0.5

jobs:
  build:
    machine:
      image: ubuntu-2004:202201-01
    steps:
      # ---- Provisioning ----
      - checkout
      - run: sudo ln -s /home/circleci/project/ /kleeweb_src
      
      - ansible-playbook/galaxy:
        galaxy-options: "--force --role-file=requirements.yml"
      - run: cd /kleeweb_src/
      
      - ansible-playbook/playbook:
          inventory: "./provisioning/hosts-ci"
          playbook: "./provisioning/deploy.yml"
          playbook-options: "--syntax-check"
      - ansible-playbook/playbook:
          inventory: "./provisioning/hosts-ci"
          playbook: "./provisioning/deploy.yml"
          playbook-options: "-vvv"
